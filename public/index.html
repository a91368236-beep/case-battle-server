<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>ğŸ”¥ Case Battle</title>

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial;
  background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
  color: #fff;
}

.app {
  max-width: 900px;
  margin: auto;
  padding: 20px;
}

.header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 20px;
}

.card {
  background: rgba(0,0,0,.4);
  padding: 16px;
  border-radius: 12px;
  margin-bottom: 16px;
}

button {
  background: #ff9800;
  border: none;
  padding: 12px 18px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
}

button:hover { opacity: .9; }

.inventory {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
  gap: 12px;
}

.item {
  background: rgba(255,255,255,.08);
  padding: 10px;
  border-radius: 8px;
}

.price { color: #ffd54f; }
</style>
</head>

<body>
<div class="app">

  <div class="header">
    <div>ğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: <b id="balance">0</b></div>
    <div>ğŸ“¦ ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¾: <b id="opened">0</b></div>
    <div>ğŸŸ¢ ĞĞ½Ğ»Ğ°Ğ¹Ğ½: <b id="online">0</b></div>
  </div>

  <div class="card">
    <button onclick="openCase()">ğŸ ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ĞºĞµĞ¹Ñ (10)</button>
    <button onclick="sellAll()">ğŸ’¸ ĞŸÑ€Ğ¾Ğ´Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘</button>
    <p id="drop"></p>
  </div>

  <div class="card">
    <h3>ğŸ’ Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ</h3>
    <div id="inv" class="inventory"></div>
  </div>

</div>

<script>
const id = localStorage.playerId ??= crypto.randomUUID();

async function load() {
  const r = await fetch(`/stats?id=${id}`);
  const d = await r.json();

  balance.textContent = d.balance;
  opened.textContent = d.opened;
  online.textContent = d.online;

  inv.innerHTML = Object.values(d.inventory).length
    ? Object.values(d.inventory).map(i => `
      <div class="item">
        <b>${i.name}</b><br>
        <span class="price">${i.price}ğŸ’°</span><br>
        x${i.qty}
      </div>`).join("")
    : "ĞŸÑƒÑÑ‚Ğ¾";
}

async function openCase() {
  const r = await fetch(`/open?id=${id}`);
  const d = await r.json();
  if (d.error) return alert("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ´ĞµĞ½ĞµĞ³");

  drop.textContent = `ğŸ‰ Ğ’Ñ‹Ğ¿Ğ°Ğ»Ğ¾: ${d.skin.name} (${d.skin.price}ğŸ’°)`;
  load();
}

async function sellAll() {
  const r = await fetch(`/sell?id=${id}`);
  const d = await r.json();
  drop.textContent = `ğŸ’¸ ĞŸÑ€Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ½Ğ° ${d.sold}`;
  load();
}

load();
</script>
</body>
</html>