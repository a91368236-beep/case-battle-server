<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Case Battle</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial;
      padding: 20px;
    }
    button, input {
      padding: 6px;
      margin: 4px;
    }
    .inv-item {
      background: #222;
      padding: 6px;
      margin: 4px 0;
      border-left: 4px solid #d32ce6;
    }
  </style>
</head>
<body>

<h1>ğŸ Case Battle</h1>

<div>
  ğŸ’° Ğ‘Ğ°Ğ»Ğ°Ğ½Ñ: <b id="balance">0</b><br>
  ğŸ“¦ ĞÑ‚ĞºÑ€Ñ‹Ñ‚Ğ¾: <b id="opened">0</b><br>
  ğŸŸ¢ ĞĞ½Ğ»Ğ°Ğ¹Ğ½: <b id="online">0</b>
</div>

<hr>

<input id="count" type="number" min="1" max="15" value="1">
<button onclick="openCases()">ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
<button onclick="sellAll()">ĞŸÑ€Ğ¾Ğ´Ğ°Ñ‚ÑŒ Ğ²ÑÑ‘</button>

<h3>ğŸ¯ Ğ’Ñ‹Ğ¿Ğ°Ğ»Ğ¾</h3>
<div id="caseView">â€”</div>

<h3>ğŸ’ Ğ˜Ğ½Ğ²ĞµĞ½Ñ‚Ğ°Ñ€ÑŒ</h3>
<div id="inv">â€”</div>

<script>
const id = localStorage.playerId ??= crypto.randomUUID();

const balance = document.getElementById("balance");
const opened = document.getElementById("opened");
const online = document.getElementById("online");
const inv = document.getElementById("inv");
const caseView = document.getElementById("caseView");
const count = document.getElementById("count");

async function load() {
  const r = await fetch(`/stats?id=${id}`);
  const d = await r.json();

  balance.textContent = d.balance;
  opened.textContent = d.opened;
  online.textContent = d.online;

  inv.innerHTML = Object.values(d.inventory).length
    ? Object.values(d.inventory).map(i =>
        `<div class="inv-item">${i.weapon} | ${i.skin} Ã— ${i.qty}</div>`
      ).join("")
    : "ĞŸÑƒÑÑ‚Ğ¾";
}

async function openCases() {
  const r = await fetch(`/open?id=${id}&count=${count.value}`);
  const d = await r.json();
  if (d.error) return alert("ĞĞµĞ´Ğ¾ÑÑ‚Ğ°Ñ‚Ğ¾Ñ‡Ğ½Ğ¾ Ğ¼Ğ¾Ğ½ĞµÑ‚");

  caseView.textContent = d.drops.map(i => `${i.weapon} | ${i.skin}`).join(" | ");
  load();
}

async function sellAll() {
  await fetch(`/sell?id=${id}`);
  caseView.textContent = "ĞŸÑ€Ğ¾Ğ´Ğ°Ğ½Ğ¾ Ğ²ÑÑ‘";
  load();
}

load();
</script>

</body>
</html>