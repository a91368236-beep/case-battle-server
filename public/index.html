<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Case Battle</title>
  <style>
    body {
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    button {
      padding: 8px 14px;
      margin: 5px 0;
      cursor: pointer;
    }
    input {
      width: 60px;
      padding: 5px;
    }
    .inv-item {
      padding: 6px;
      margin: 4px 0;
      background: #222;
      border-left: 4px solid #888;
    }
    .classified { border-color: #d32ce6; }
  </style>
</head>
<body>

  <h1>üéÅ Case Battle</h1>

  <div>
    üí∞ –ë–∞–ª–∞–Ω—Å: <b id="balance">0</b><br>
    üì¶ –û—Ç–∫—Ä—ã—Ç–æ –∫–µ–π—Å–æ–≤: <b id="opened">0</b><br>
    üü¢ –û–Ω–ª–∞–π–Ω: <b id="online">0</b>
  </div>

  <hr>

  <div>
    <input id="count" type="number" min="1" max="15" value="1">
    <button onclick="openCases()">–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å—ã</button>
    <button onclick="sellAll()">–ü—Ä–æ–¥–∞—Ç—å –≤—Å—ë</button>
  </div>

  <h3>üéØ –í—ã–ø–∞–ª–æ</h3>
  <div id="caseView">‚Äî</div>

  <h3>üéí –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</h3>
  <div id="inv">–ó–∞–≥—Ä—É–∑–∫–∞...</div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const balance = document.getElementById("balance");
      const opened = document.getElementById("opened");
      const online = document.getElementById("online");
      const inv = document.getElementById("inv");
      const caseView = document.getElementById("caseView");
      const count = document.getElementById("count");

      async function load() {
        const r = await fetch("/stats");
        const d = await r.json();

        balance.textContent = d.balance;
        opened.textContent = d.opened;
        online.textContent = d.online;

        inv.innerHTML = Object.values(d.inventory).length
          ? Object.values(d.inventory).map(i => `
              <div class="inv-item ${i.rarity}">
                ${i.weapon} | ${i.skin} √ó ${i.qty}
              </div>
            `).join("")
          : "–ü—É—Å—Ç–æ";
      }

      window.openCases = async function () {
        const c = count.value;
        const r = await fetch(`/open?count=${c}`);
        const d = await r.json();
        if (d.error) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç");

        caseView.textContent = d.drops
          .map(i => `${i.weapon} | ${i.skin}`)
          .join(" | ");

        load();
      }

      window.sellAll = async function () {
        await fetch("/sell");
        caseView.textContent = "–ü—Ä–æ–¥–∞–Ω–æ –≤—Å—ë";
        load();
      }

      load();
    });
  </script>

</body>
</html>